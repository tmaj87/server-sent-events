function getColor(){var a=(Math.round(180*Math.random())+50).toString(16),b=(Math.round(180*Math.random())+50).toString(16),c=(Math.round(180*Math.random())+50).toString(16);return a+b+c}function error(a){$("#message_box").append('<div class="message"><span class="content" style="color: red">'+a+"</span></div>")}var color=getColor(),lastId=0,iam=0;$.ajax({url:$("#message_form").attr("action"),type:"post",data:{iam:1},success:function(a){iam=a}});
$.ajax({url:$("#message_form").attr("action"),type:"post",data:{re:1}});
if(window.EventSource){var obj=new EventSource($("#message_form").attr("action"));obj.addEventListener("message",function(a){if(a.lastEventId!=lastId){lastId=a.lastEventId;a=JSON.parse(a.data);var b=$('<div class="message"><span class="time">'+a.t+'</span><span class="nick" style="color: #'+a.c+'">'+a.n+'<span class="hash">'+a.h+'</span></span><span class="content">'+a.m+"</span></div>");a.h!=iam&&$("#sound_box").html('<audio autoplay><source src="czat_ding.wav" type="audio/wav"></audio>');b.hide();
a.c!=color&&b.css("background","white");$("#message_box").append(b);b.slideDown(200,function(){$("#message_box").scrollTop($("#message_box")[0].scrollHeight)})}},!1);obj.addEventListener("users",function(a){a=JSON.parse(a.data);$("#users_box").html("");for(id in a)$("#users_box").append('<span class="user" style="color: #'+a[id]+'">'+id+"</span>")},!1)}$('#message_form input[name="c"]').val(color);$('#message_form input[name="u"]').css("color","#"+color);
$("#message_form").submit(function(a){a.preventDefault();$.ajax({url:$(this).attr("action"),type:$(this).attr("method"),data:$(this).serializeArray(),success:function(a){"nop"!=a?$('#message_form input[name="m"]').val(""):error("Poczekaj.")}})});
